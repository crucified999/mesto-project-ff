(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,n,o){var r=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),c=r.querySelector(".card__delete-button"),i=r.querySelector(".card__like-button"),s=r.querySelector(".card__likes-amount"),u=r.querySelector(".card__image");return s.textContent=e.likes,u.src=e.link,u.alt=e.name,u.addEventListener("click",o),r.querySelector(".card__title").textContent=e.name,c.addEventListener("click",(function(){a(e.id).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){t(r)}))})),i.addEventListener("click",(function(t){n(t,e.id,s)})),r}function n(e,t,n){c(e,t,n)}function o(e){e.remove()}e.d({},{b7:()=>b,ay:()=>w,t$:()=>j,O7:()=>A,qK:()=>V,dm:()=>y,mo:()=>T,Qn:()=>O});var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-34",headers:{authorization:"dc9d655b-4c4c-4981-8e4a-cbe7891c9e9e","Content-Type":"application/json"}},c=function(e,t,n){e.target.classList.contains("card__like-button_is-active")?(n.textContent=Number(n.textContent)-1,e.target.classList.remove("card__like-button_is-active"),fetch("https://nomoreparties.co/v1/wff-cohort-34/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"dc9d655b-4c4c-4981-8e4a-cbe7891c9e9e"}})):(n.textContent=Number(n.textContent)+1,e.target.classList.add("card__like-button_is-active"),fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:r.headers}))},a=function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers})};function i(e,t){t?(e.textContent="Сохранение...",e.disabled=!0):(e.textContent="Сохранить",e.disabled=!1)}function s(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function l(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function d(e){e.target.classList.contains("popup")&&u(document.querySelector(".popup_is-opened"))}var p=fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){e.forEach((function(e){var r=t({name:e.name,link:e.link,likes:e.likes.length,id:e._id},o,n,V);e.owner.name!==O.textContent&&(r.querySelector(".card__delete-button").style.display="none"),e.likes.some((function(e){return e.name===O.textContent}))&&r.querySelector(".card__like-button").classList.add("card__like-button_is-active"),y.append(r)}))})).catch((function(e){console.log(e)}));function f(e,t,n,o){e.classList.remove("".concat(n)),t.classList.remove("".concat(o)),t.textContent=""}function m(e,t,n,o){var r;e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?f(e,t,n,o):(0===e.value.length?r="Вы пропустили это поле.":e.validity.patternMismatch?r=e.dataset.errorMessage:e.value.length<e.minLength&&(r="Минимальное количество символов: 2. \n                            Длина текста сейчас: ".concat(e.value.length," символов")),function(e,t,n,o,r){e.classList.add("".concat(o)),t.classList.add("".concat(r)),t.textContent=n}(e,t,r,n,o))}var _=fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){O.textContent=e.name,T.textContent=e.about,M.style.backgroundImage="url(".concat(e.avatar,")"),w.textContent="Сохранить"})).catch((function(e){console.log(e)}));Promise.all([_,p]).then((function(e){console.log("...")}));var v={formSelector:".popup__form",inputSelector:".popup__input",errorMessageSelector:".popup__error",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){for(var n=Array.from(t.querySelectorAll("".concat(e.inputSelector))),o=Array.from(t.querySelectorAll("".concat(e.errorMessageSelector))),r=t.querySelector("".concat(e.submitButtonSelector)),c=function(){var t=n[a],r=o[a];t.addEventListener("input",(function(){m(t,r,e.inputErrorClass,e.errorClass)}))},a=0;a<n.length;a++)c();t.addEventListener("input",(function(){!function(e,t,n){var o=!0;e.forEach((function(e){e.validity.valid||(o=!1)})),o?(t.disabled=!1,t.classList.remove("".concat(n))):(t.disabled=!0,t.classList.add("".concat(n)))}(n,r,e.inactiveButtonClass)}))}))}(v);var y=document.querySelector(".places__list"),h=document.querySelectorAll(".popup"),b=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),g=document.querySelector(".popup_type_avatar"),q=k.querySelector(".popup__caption"),C=k.querySelector(".popup__image"),L=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__add-button"),x=document.forms["edit-profile"],j=x.elements.name,A=x.elements.description,P=x.querySelectorAll(".popup__input"),U=x.querySelectorAll(".popup__error"),w=x.querySelector(".popup__button"),O=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),N=document.forms["new-place"],B=N.querySelectorAll(".popup__input"),D=N.querySelectorAll(".popup__error"),J=N.querySelector(".popup__button"),z=document.forms.avatar,H=z.elements.avatar,I=z.querySelector(".popup__button");function V(e){q.textContent=e.target.alt,C.src=e.target.src,C.alt=e.target.alt,s(k)}B.forEach((function(e){var t=N.querySelector("input[name='".concat(e.name,"'] + .popup__error"));e.addEventListener("input",(function(){m(e,t,v.inputErrorClass,v.errorClass)}))})),L.addEventListener("click",(function(){j.value=O.textContent,A.value=T.textContent;for(var e=0;e<P.length;e++)m(P[e],U[e],v.inputErrorClass,v.errorClass);s(b)})),E.addEventListener("click",(function(){s(S),J.disabled=!0,J.classList.add("".concat(v.inactiveButtonClass))})),M.addEventListener("click",(function(){s(g)})),z.addEventListener("submit",(function(e){var t;e.preventDefault(),i(I,!0),(t=H.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){i(I,!1),M.style.backgroundImage="url(".concat(H.value,")"),u(g)}))})),h.forEach((function(e){var t=e.querySelector(".popup__close");e.classList.add("popup_is-animated"),t.addEventListener("click",(function(){return u(e)})),e.addEventListener("click",d)})),x.addEventListener("submit",(function(e){e.preventDefault(),i(w,!0),fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:j.value,about:A.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){i(w,!1),u(b),O.textContent=j.value,T.textContent=A.value}))})),N.addEventListener("submit",(function(e){e.preventDefault();var c={name:N.elements["place-name"].value,link:N.elements.link.value,likes:0},a=t(c,o,n,V);i(J,!0),function(e){return fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:e.name,link:e.link})})}(c).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){return console.log(e)})).catch((function(e){console.log(e)})).finally((function(){i(J,!1),y.prepend(a),u(S);for(var e=0;e<B.length;e++){var t=B[e];f(t,D[e],v.inputErrorClass,v.errorClass),t.value=""}}))}))})();