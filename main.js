(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{b7:()=>_,ay:()=>j,t$:()=>L,O7:()=>C,mo:()=>P,Qn:()=>x,bY:()=>I});var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-34",headers:{authorization:"dc9d655b-4c4c-4981-8e4a-cbe7891c9e9e","Content-Type":"application/json"}};function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function c(e){e.target.classList.contains("popup")&&o(document.querySelector(".popup_is-opened"))}function a(e,t,n,o){var r=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),c=r.querySelector(".card__delete-button"),a=r.querySelector(".card__like-button"),i=r.querySelector(".card__likes-amount"),s=r.querySelector(".card__image");return i.textContent=e.likes,s.src=e.link,s.alt=e.name,s.addEventListener("click",o),r.querySelector(".card__title").textContent=e.name,c.addEventListener("click",(function(){t(e.id,r)})),a.addEventListener("click",(function(t){n(t,e.id,i)})),r}function i(e,n,o){e.target.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))}(n).then((function(t){o.textContent=t.likes.length,e.target.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))}(n).then((function(t){o.textContent=t.likes.length,e.target.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))}function s(e,n){(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))})(e).then((function(){n.remove()})).catch((function(e){console.log(e)}))}function u(e,t,n,o){e.classList.remove("".concat(n)),t.classList.remove("".concat(o)),t.textContent=""}function l(e,t,n,o){var r;e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?u(e,t,n,o):(0===e.value.length?r="Вы пропустили это поле.":e.validity.patternMismatch?r=e.dataset.errorMessage:e.value.length<e.minLength&&(r="Минимальное количество символов: 2. \n                            Длина текста сейчас: ".concat(e.value.length," символов")),function(e,t,n,o,r){e.classList.add("".concat(o)),t.classList.add("".concat(r)),t.textContent=n}(e,t,r,n,o))}function d(e,t,n){var o=!0;e.forEach((function(e){e.validity.valid||(o=!1)})),o?(t.disabled=!1,t.classList.remove("".concat(n))):(t.disabled=!0,t.classList.add("".concat(n)))}Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))]).then((function(e){var t=e[0],n=e[1];x.textContent=t.name,P.textContent=t.about,A.style.backgroundImage="url(".concat(t.avatar,")"),n.forEach((function(e){var n=a({name:e.name,link:e.link,likes:e.likes.length,id:e._id},s,i,H);e.owner._id!==t._id&&(n.querySelector(".card__delete-button").style.display="none"),e.likes.some((function(e){return e._id===t._id}))&&n.querySelector(".card__like-button").classList.add("card__like-button_is-active"),f.append(n)}))})).catch((function(e){console.log(e)}));var p={formSelector:".popup__form",inputSelector:".popup__input",errorMessageSelector:".popup__error",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){for(var n=Array.from(t.querySelectorAll("".concat(e.inputSelector))),o=Array.from(t.querySelectorAll("".concat(e.errorMessageSelector))),r=t.querySelector("".concat(e.submitButtonSelector)),c=function(){var t=n[a],r=o[a];t.addEventListener("input",(function(){l(t,r,e.inputErrorClass,e.errorClass)}))},a=0;a<n.length;a++)c();t.addEventListener("input",(function(){d(n,r,e.inactiveButtonClass)}))}))}(p);var f=document.querySelector(".places__list"),m=document.querySelectorAll(".popup"),_=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),y=document.querySelector(".popup_type_avatar"),b=h.querySelector(".popup__caption"),S=h.querySelector(".popup__image"),k=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__add-button"),q=document.forms["edit-profile"],L=q.elements.name,C=q.elements.description,E=q.querySelectorAll(".popup__input"),j=q.querySelector(".popup__button"),x=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),A=document.querySelector(".profile__image"),U=document.forms["new-place"],O=U.querySelectorAll(".popup__input"),w=U.elements["place-name"],T=U.elements.link,B=U.querySelectorAll(".popup__error"),M=U.querySelector(".popup__button"),D=document.forms.avatar,N=D.elements.avatar,J=D.querySelector(".popup__button");function H(e){b.textContent=e.target.alt,S.src=e.target.src,S.alt=e.target.alt,n(h)}function I(e,t){t?(e.textContent="Сохранение...",e.disabled=!0):(e.textContent="Сохранить",e.disabled=!1)}O.forEach((function(e){var t=U.querySelector("input[name='".concat(e.name,"'] + .popup__error"));e.addEventListener("input",(function(){l(e,t,p.inputErrorClass,p.errorClass)}))})),k.addEventListener("click",(function(){L.value=x.textContent,C.value=P.textContent,n(_)})),g.addEventListener("click",(function(){n(v),d(E,j,p.inactiveButtonClass),M.classList.add("".concat(p.inactiveButtonClass))})),A.addEventListener("click",(function(){n(y)})),D.addEventListener("submit",(function(e){var n;e.preventDefault(),I(J,!0),(n=N.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))).then((function(){A.style.backgroundImage="url(".concat(N.value,")"),o(y)})).catch((function(e){console.log(e)})).finally((function(){I(J,!1)}))})),m.forEach((function(e){var t=e.querySelector(".popup__close");e.classList.add("popup_is-animated"),t.addEventListener("click",(function(){return o(e)})),e.addEventListener("click",c)})),q.addEventListener("submit",(function(e){e.preventDefault(),I(j,!0),fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:L.value,about:C.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){I(j,!1),o(_),x.textContent=L.value,P.textContent=C.value}))})),U.addEventListener("submit",(function(e){e.preventDefault();var n,r={name:w.value,link:T.value};I(M,!0),(n=r,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n.name,link:n.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))).then((function(e){var t=a({name:e.name,link:e.link,likes:e.likes.length,id:e._id},s,i,H);f.prepend(t),o(v)})).catch((function(e){console.log(e)})).finally((function(){I(M,!1),function(e,t,n,o){for(var r=0;r<e.length;r++)u(e[r],t[r],n,o)}(O,B,p.inputErrorClass,p.errorClass)}))}))})();